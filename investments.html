<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Investments | TheMarketBriefDaily</title>

<style>
:root{
  --bg:#ffffff;
  --ink:#0b1220;
  --muted: rgba(11,18,32,.68);
  --muted2: rgba(11,18,32,.46);
  --line: rgba(11,18,32,.12);
  --brand:#0b4ea2;
  --max: 1180px;
  --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, Helvetica, Arial, sans-serif;
  --r:16px;
  --shadow: 0 18px 45px rgba(2,6,23,.10);
}
*{ box-sizing:border-box; }
html,body{ margin:0; padding:0; }
body{
  font-family: var(--font);
  color: var(--ink);
  background: var(--bg);
  line-height: 1.65;
  -webkit-font-smoothing: antialiased;
}
.container{ width: min(var(--max), calc(100% - 56px)); margin: 0 auto; }

.site-header{
  position: sticky;
  top: 0;
  z-index: 50;
  background: rgba(255,255,255,.92);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--line);
}
.header-inner{
  display:flex; align-items:center; justify-content:space-between;
  padding: 16px 0; gap: 24px;
}
.brand{ display:flex; flex-direction:column; gap:2px; }
.brand-title{ font-weight: 850; letter-spacing: -.2px; line-height: 1.1; }
.brand-sub{ font-size: 13px; color: var(--muted2); }

.nav{ display:flex; gap: 18px; align-items:center; flex-wrap:wrap; }
.nav a{
  color: var(--ink);
  font-weight: 650;
  font-size: 14px;
  padding: 10px 2px 8px;
  border-bottom: 2px solid transparent;
  text-decoration:none;
}
.nav a:hover{ border-bottom-color: rgba(11,18,32,.18); }
.nav a.is-active{ border-bottom-color: var(--ink); }

.section{ padding: 30px 0 44px; }
.kicker{
  font-size: 12px; letter-spacing: .16em; text-transform: uppercase;
  color: var(--muted2); margin-bottom: 10px;
}
h1{ margin:0 0 6px; font-size: 34px; letter-spacing: -.3px; }
.lead{ margin:0 0 18px; color: var(--muted); max-width: 95ch; }

.portfolio{
  border: 1px solid var(--line);
  border-radius: 16px;
  padding: 18px;
  background: #fff;
  box-shadow: var(--shadow);
}

.portfolio-top{
  display:flex; justify-content:space-between; gap: 16px;
  align-items:flex-start; flex-wrap: wrap;
}
.p-title{ font-weight: 850; letter-spacing: -.2px; }
.p-sub{ color: var(--muted2); font-size: 13px; margin-top: 4px; }

.statusline{
  margin-top:8px;
  font-size:13px;
  color: var(--muted);
}
.statusline strong{ color: var(--ink); }

.p-actions{ display:flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
.p-btn{
  display:inline-flex; align-items:center; justify-content:center;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: #fff;
  color: var(--ink);
  font-weight: 750;
  cursor: pointer;
}
.p-btn:hover{ background: rgba(11,18,32,.03); }

.p-kpis{
  display:grid;
  grid-template-columns: repeat(4, minmax(160px, 1fr));
  gap: 12px;
  width: 100%;
  margin-top: 14px;
}
.kpi{
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 12px;
  background: #fff;
}
.kpi .label{
  font-size: 12px;
  color: var(--muted2);
  letter-spacing: .08em;
  text-transform: uppercase;
}
.kpi .value{
  font-weight: 850;
  margin-top: 6px;
  font-size: 18px;
}
.kpi .sub{ margin-top: 4px; color: var(--muted); font-size: 13px; }

.table-wrap{
  overflow:auto;
  border: 1px solid var(--line);
  border-radius: 16px;
  margin-top: 14px;
}
table{
  width: 100%;
  border-collapse: collapse;
  min-width: 1180px;
  background:#fff;
}
th, td{
  padding: 12px 12px;
  border-bottom: 1px solid var(--line);
  text-align: left;
  vertical-align: top;
  font-size: 14px;
}
th{
  font-size: 12px;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: var(--muted2);
  background: #fff;
  white-space: nowrap;
}
td small{ color: var(--muted2); }

.pos{ color: #0a7a3a; font-weight: 850; }
.neg{ color: #b42318; font-weight: 850; }
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace; }

.details{ margin-top: 14px; display:grid; gap: 10px; }
details{
  border: 1px solid var(--line);
  border-radius: 16px;
  background:#fff;
  padding: 12px 14px;
}
summary{ cursor:pointer; font-weight: 850; }
.tags{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
.tag{
  border:1px solid var(--line);
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  color: var(--muted);
}

.chartbox{
  border: 1px solid var(--line);
  border-radius: 16px;
  padding: 12px;
  margin-top: 14px;
}
canvas{ width:100%; height:260px; display:block; }

.note{
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid var(--line);
  font-size: 13px;
  color: var(--muted);
}

@media (max-width: 900px){
  .container{ width: min(var(--max), calc(100% - 34px)); }
  .header-inner{ flex-direction: column; align-items:flex-start; }
  .p-kpis{ grid-template-columns: 1fr 1fr; }
}
</style>
</head>

<body>
<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <div class="brand-title">TheMarketBriefDaily</div>
      <div class="brand-sub">Market structure · metals · macro</div>
    </div>
    <nav class="nav">
      <a href="./index.html">Home</a>
      <a class="is-active" href="./investments.html">Investments</a>
      <a href="./about.html">About</a>
      <a href="./disclaimer.html">Disclaimer</a>
    </nav>
  </div>
</header>

<main class="container section">
  <div class="kicker">Public model portfolio</div>
  <h1>Investments</h1>
  <p class="lead">
    Intraday marks are fetched from Alpha Vantage. Free-tier is rate-limited, so quotes update sequentially.
    Table never blanks — it loads immediately and fills intraday marks as they arrive.
  </p>

  <section class="portfolio">
    <div class="portfolio-top">
      <div>
        <div class="p-title">Portfolio Overview</div>
        <div class="p-sub">
          As of <span id="asof" class="mono">—</span> ·
          Last trading day: <span id="lastTS" class="mono">—</span>
        </div>
        <div class="statusline">
          <strong>Status:</strong> <span id="quoteStatus" class="mono">ready</span>
          <span id="quoteError" style="display:none; margin-left:10px;" class="mono"></span>
        </div>
      </div>
      <div class="p-actions">
        <button class="p-btn" id="refreshQuotesBtn">Refresh intraday prices</button>
        <button class="p-btn" id="refreshHistoryBtn">Refresh history (slow)</button>
        <button class="p-btn" id="toggleThesisBtn">Expand all theses</button>
      </div>
    </div>

    <div class="p-kpis">
      <div class="kpi">
        <div class="label">Total Capital</div>
        <div class="value mono" id="totalCap">$100,000</div>
        <div class="sub">Model capital.</div>
      </div>
      <div class="kpi">
        <div class="label">Portfolio Value (NAV)</div>
        <div class="value mono" id="nav">—</div>
        <div class="sub">Invested + cash.</div>
      </div>
      <div class="kpi">
        <div class="label">P/L</div>
        <div class="value mono" id="pl">—</div>
        <div class="sub">Mark-to-market vs cost basis.</div>
      </div>
      <div class="kpi">
        <div class="label">Since Inception</div>
        <div class="value mono" id="si">—</div>
        <div class="sub">Return since inception date.</div>
      </div>
    </div>

    <div class="chartbox">
      <div class="kicker" style="margin:0 0 8px;">Performance since inception (NAV)</div>
      <canvas id="navChart" width="1200" height="320"></canvas>
      <div class="note" id="chartNote">
        History not loaded. Click “Refresh history (slow)” once (cached in your browser).
      </div>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Asset</th>
            <th>Ticker</th>
            <th class="mono">Shares</th>
            <th class="mono">Entry</th>
            <th class="mono">Last</th>
            <th class="mono">Cost</th>
            <th class="mono">Mkt Value</th>
            <th class="mono">P/L ($)</th>
            <th class="mono">P/L (%)</th>
            <th>Stage</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>

    <div class="details" id="thesisBlocks"></div>

    <div class="note">
      <strong>Disclosure:</strong> informational model portfolio only; not investment advice.
      Intraday pricing depends on Alpha Vantage availability and rate limits.
    </div>
  </section>
</main>

<script>
/* ========= CONFIG ========= */
const AV_KEY = "GUY8S89NSG15NVYH";

// free-tier safe delay: ~5 requests/minute. 6 tickers => ~70s refresh.
const QUOTE_DELAY_MS = 14000;

const TOTAL_CAPITAL = 100000;
const INCEPTION_DATE = "2026-02-01";

// Small allocations (change whenever you want)
const targetDollars = { AGI:2000, FSM:1500, GAU:1000, NFGC:800, VGZ:700, NEWP:1000 };

// Your entry prices
const entry = { AGI:42.20, FSM:10.39, GAU:2.69, NFGC:2.69, VGZ:2.65, NEWP:3.53 };

const meta = {
  AGI: { name:"Alamos Gold", stage:"Producer",
    thesis:["Established producer; lower relative risk within miners.","Watch AISC trend and execution vs guidance.","Sized small; cycle + execution thesis."],
    watch:["AISC trend","guidance updates","capex vs FCF","jurisdiction risk"]
  },
  FSM: { name:"Fortuna Mining", stage:"Producer",
    thesis:["Gold/silver hybrid with geographic diversification.","Satellite position; thesis improves with margin expansion.","Sized small due to miner beta."],
    watch:["cost control","jurisdiction stability","balance sheet","metal sensitivity"]
  },
  GAU: { name:"Galiano Gold", stage:"Turnaround / Small Cap",
    thesis:["Turnaround / execution story in smaller cap.","Single-asset concentration risk acknowledged.","Sized small to reflect idiosyncratic risk."],
    watch:["resource updates","operational KPIs","financing/dilution","country risk"]
  },
  NFGC: { name:"New Found Gold", stage:"Developer",
    thesis:["High-grade discovery optionality; pre-revenue risk.","Primary risk: financing/dilution + timeline.","Very small sizing: asymmetric attempt."],
    watch:["drill continuity","permits/mill path","financing terms","timeline"]
  },
  VGZ: { name:"Vista Gold", stage:"Developer",
    thesis:["Long-dated gold leverage; milestones matter.","Macro regime sensitivity; low carry while waiting.","Small sizing due to timeline/project risk."],
    watch:["milestones","partnering/financing","capex assumptions","jurisdiction"]
  },
  NEWP:{ name:"New Pacific Metals", stage:"Developer (Silver)",
    thesis:["Silver optionality via undeveloped projects.","High jurisdiction/political risk; sized accordingly.","Thesis: cycle exposure + advancement."],
    watch:["policy risk","community relations","resource advancement","silver cycle"]
  }
};

const tickers = Object.keys(targetDollars);
const shares = Object.fromEntries(tickers.map(t => [t, targetDollars[t] / entry[t]]));

/* ========= UTIL ========= */
const el = id => document.getElementById(id);
const fmtUSD0 = n => n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0});
const fmtUSD2 = n => n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:2});
const fmtPct = n => (n>=0?"+":"") + n.toFixed(2) + "%";
const sleep = ms => new Promise(r=>setTimeout(r,ms));

function setError(msg){
  const e = el("quoteError");
  if(!msg){
    e.style.display="none";
    e.textContent="";
    return;
  }
  e.style.display="inline";
  e.style.color="#b42318";
  e.textContent = "· " + msg;
}

/* ========= QUOTES ========= */
async function fetchQuote(symbol){
  const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${encodeURIComponent(symbol)}&apikey=${encodeURIComponent(AV_KEY)}`;
  const res = await fetch(url, {cache:"no-store"});
  const data = await res.json();

  if(data.Note) throw new Error("Rate limited by Alpha Vantage. Wait ~60s then try again.");
  if(data["Error Message"]) throw new Error("Alpha Vantage error for " + symbol);

  const q = data["Global Quote"];
  if(!q || !q["05. price"]) throw new Error("No quote returned for " + symbol);

  return {
    price: Number(q["05. price"]),
    ts: (q["07. latest trading day"] || "")
  };
}

/* ========= TABLE RENDER ========= */
function renderTableSkeleton(){
  const tbody = el("rows");
  tbody.innerHTML = "";
  for(const t of tickers){
    const sh = shares[t];
    const cost = sh * entry[t];
    const tr = document.createElement("tr");
    tr.id = `row_${t}`;
    tr.innerHTML = `
      <td><strong>${meta[t].name}</strong><br/><small>${meta[t].stage}</small></td>
      <td class="mono"><strong>${t}</strong></td>
      <td class="mono">${sh.toFixed(4)}</td>
      <td class="mono">${fmtUSD2(entry[t])}</td>
      <td class="mono" id="last_${t}">—</td>
      <td class="mono">${fmtUSD0(cost)}</td>
      <td class="mono" id="mv_${t}">—</td>
      <td class="mono" id="pl_${t}">—</td>
      <td class="mono" id="plp_${t}">—</td>
      <td>${meta[t].stage}</td>
    `;
    tbody.appendChild(tr);
  }
}

function updateRow(t, price){
  const sh = shares[t];
  const mv = sh * price;
  const cost = sh * entry[t];
  const pl = mv - cost;
  const plPct = (pl / cost) * 100;
  const cls = pl >= 0 ? "pos" : "neg";

  el(`last_${t}`).textContent = fmtUSD2(price);
  el(`mv_${t}`).textContent = fmtUSD0(mv);

  const plEl = el(`pl_${t}`);
  plEl.textContent = fmtUSD0(pl);
  plEl.className = `mono ${cls}`;

  const plpEl = el(`plp_${t}`);
  plpEl.textContent = fmtPct(plPct);
  plpEl.className = `mono ${cls}`;
}

function updateKPIs(latestPx){
  let invested = 0;
  let plTotal = 0;
  for(const t of tickers){
    if(!latestPx[t]) continue;
    const sh = shares[t];
    const mv = sh * latestPx[t];
    const cost = sh * entry[t];
    invested += mv;
    plTotal += (mv - cost);
  }
  const cash = Math.max(0, TOTAL_CAPITAL - invested);
  const nav = invested + cash;
  const si = ((nav / TOTAL_CAPITAL) - 1) * 100;

  el("totalCap").textContent = fmtUSD0(TOTAL_CAPITAL);
  el("nav").textContent = isFinite(nav) ? fmtUSD0(nav) : "—";
  el("pl").textContent = isFinite(plTotal) ? ((plTotal>=0?"+":"") + fmtUSD0(plTotal)) : "—";
  el("si").textContent = isFinite(si) ? fmtPct(si) : "—";
}

/* ========= THESES ========= */
function renderTheses(){
  const wrap = el("thesisBlocks");
  wrap.innerHTML = "";
  for(const t of tickers){
    const d = document.createElement("details");
    d.innerHTML = `
      <summary>${meta[t].name} <span class="mono" style="color:var(--muted2); font-weight:650;">(${t})</span></summary>
      <div class="note" style="border-top:none; padding-top:8px;">
        <div class="kicker" style="margin:0 0 6px;">Thesis</div>
        <ul style="margin:0 0 10px 18px; color:var(--muted);">
          ${meta[t].thesis.map(x=>`<li>${x}</li>`).join("")}
        </ul>
        <div class="kicker" style="margin:0 0 6px;">What to watch</div>
        <div class="tags">
          ${meta[t].watch.map(w=>`<span class="tag">${w}</span>`).join("")}
        </div>
      </div>
    `;
    wrap.appendChild(d);
  }
}

/* ========= HISTORY (kept as-is minimal) ========= */
function drawPlaceholder(canvas, msg){
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "rgba(11,18,32,.65)";
  ctx.font = "14px system-ui";
  ctx.fillText(msg, 54, 46);
}
drawPlaceholder(el("navChart"), "History not loaded. Click “Refresh history (slow)”. (Cached after first run.)");

/* ========= QUOTE REFRESH ========= */
async function refreshQuotes(){
  setError("");
  const latestPx = {};
  el("quoteStatus").textContent = "refreshing (rate-limited)…";
  el("lastTS").textContent = "—";

  for(let i=0;i<tickers.length;i++){
    const t = tickers[i];
    el("quoteStatus").textContent = `fetching ${t} (${i+1}/${tickers.length})…`;

    try{
      const q = await fetchQuote(t);
      latestPx[t] = q.price;
      updateRow(t, q.price);
      updateKPIs(latestPx);
      if(q.ts) el("lastTS").textContent = q.ts;
    }catch(err){
      setError(err.message);
      el("quoteStatus").textContent = "error";
      return;
    }

    if(i < tickers.length - 1) await sleep(QUOTE_DELAY_MS);
  }

  localStorage.setItem("mbd_lastQuotes", JSON.stringify({ savedAt: Date.now(), latestPx, lastTS: el("lastTS").textContent }));
  el("quoteStatus").textContent = `ok (${tickers.length} quotes)`;
}

/* ========= BUTTONS ========= */
let expanded = false;
el("toggleThesisBtn").addEventListener("click", ()=>{
  const blocks = document.querySelectorAll("#thesisBlocks details");
  expanded = !expanded;
  blocks.forEach(d => d.open = expanded);
  el("toggleThesisBtn").textContent = expanded ? "Collapse all theses" : "Expand all theses";
});

el("refreshQuotesBtn").addEventListener("click", refreshQuotes);

// history button left intentionally (you can paste your prior history code here)
el("refreshHistoryBtn").addEventListener("click", ()=>{
  setError("History refresh not wired in this patch. Keep your previous history module or tell me and I’ll merge it cleanly.");
});

/* ========= INIT ========= */
(function init(){
  el("asof").textContent = new Date().toLocaleDateString(undefined,{year:"numeric",month:"short",day:"2-digit"});
  el("totalCap").textContent = fmtUSD0(TOTAL_CAPITAL);
  renderTableSkeleton();
  renderTheses();

  // Load cached quotes if available (fills immediately)
  try{
    const cached = JSON.parse(localStorage.getItem("mbd_lastQuotes") || "null");
    if(cached && cached.latestPx){
      for(const t of tickers){
        if(cached.latestPx[t]) updateRow(t, cached.latestPx[t]);
      }
      updateKPIs(cached.latestPx);
      el("quoteStatus").textContent = "cached quotes loaded";
      el("lastTS").textContent = cached.lastTS || "—";
    }else{
      el("quoteStatus").textContent = "ready · click Refresh intraday prices";
    }
  }catch{
    el("quoteStatus").textContent = "ready · click Refresh intraday prices";
  }
})();
</script>
</body>
</html>
