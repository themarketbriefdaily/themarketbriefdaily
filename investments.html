<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Investments | TheMarketBriefDaily</title>

<style>
:root{
  --bg:#ffffff;
  --ink:#0b1220;
  --muted: rgba(11,18,32,.68);
  --muted2: rgba(11,18,32,.46);
  --line: rgba(11,18,32,.12);
  --brand:#0b4ea2;

  --max: 1180px;
  --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Inter, Roboto, Helvetica, Arial, sans-serif;

  --r:16px;
  --shadow: 0 18px 45px rgba(2,6,23,.10);
}

*{ box-sizing:border-box; }
html,body{ margin:0; padding:0; }
body{
  font-family: var(--font);
  color: var(--ink);
  background: var(--bg);
  line-height: 1.65;
  -webkit-font-smoothing: antialiased;
}

a{ color: var(--brand); text-decoration:none; }
a:hover{ text-decoration: underline; text-underline-offset: 3px; }

.container{
  width: min(var(--max), calc(100% - 56px));
  margin: 0 auto;
}

.site-header{
  position: sticky;
  top: 0;
  z-index: 50;
  background: rgba(255,255,255,.92);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--line);
}
.header-inner{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 16px 0;
  gap: 24px;
}
.brand{
  display:flex;
  flex-direction:column;
  gap:2px;
  color: var(--ink);
  min-width: 280px;
}
.brand-title{
  font-weight: 850;
  letter-spacing: -.2px;
  line-height: 1.1;
}
.brand-sub{
  font-size: 13px;
  color: var(--muted2);
}
.nav{
  display:flex;
  gap: 18px;
  align-items:center;
  flex-wrap: wrap;
}
.nav a{
  color: var(--ink);
  font-weight: 650;
  font-size: 14px;
  padding: 10px 2px 8px;
  border-bottom: 2px solid transparent;
}
.nav a:hover{ border-bottom-color: rgba(11,18,32,.18); text-decoration:none; }
.nav a.is-active{ border-bottom-color: var(--ink); }

.section{
  padding: 30px 0 44px;
}
.kicker{
  font-size: 12px;
  letter-spacing: .16em;
  text-transform: uppercase;
  color: var(--muted2);
  margin-bottom: 10px;
}
h1{
  margin: 0 0 6px;
  font-size: 34px;
  letter-spacing: -.3px;
}
.lead{
  margin: 0 0 18px;
  color: var(--muted);
  max-width: 95ch;
}

/* ===== Portfolio box ===== */
.portfolio{
  border: 1px solid var(--line);
  border-radius: 16px;
  padding: 18px;
  background: #fff;
  box-shadow: var(--shadow);
  margin-bottom: 26px;
}
.portfolio-top{
  display:flex;
  justify-content:space-between;
  gap: 16px;
  align-items:flex-start;
  flex-wrap: wrap;
}
.p-title{
  font-weight: 850;
  letter-spacing: -.2px;
}
.p-sub{
  color: var(--muted2);
  font-size: 13px;
  margin-top: 4px;
}

.statusline{
  margin-top: 8px;
  font-size: 13px;
  color: var(--muted);
}
.statusline strong{ color: var(--ink); }
.mono{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding: 6px 10px;
  border: 1px solid var(--line);
  border-radius: 999px;
  background:#fff;
  font-size:12px;
  color: var(--muted);
  margin-left: 10px;
}
.badge.ok{ border-color: rgba(10,122,58,.20); color: rgba(10,122,58,.95); }
.badge.warn{ border-color: rgba(180,35,24,.20); color: rgba(180,35,24,.92); }

.p-actions{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-top: 10px;
}
.p-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: #fff;
  color: var(--ink);
  font-weight: 750;
  cursor: pointer;
}
.p-btn:hover{ background: rgba(11,18,32,.03); }

.p-kpis{
  display:grid;
  grid-template-columns: repeat(4, minmax(160px, 1fr));
  gap: 12px;
  width: 100%;
  margin-top: 14px;
}
.kpi{
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 12px;
  background: #fff;
}
.kpi .label{
  font-size: 12px;
  color: var(--muted2);
  letter-spacing: .08em;
  text-transform: uppercase;
}
.kpi .value{
  font-weight: 850;
  margin-top: 6px;
  font-size: 18px;
}
.kpi .sub{
  margin-top: 4px;
  color: var(--muted);
  font-size: 13px;
}

.panel{
  border: 1px solid var(--line);
  border-radius: 16px;
  padding: 14px;
  background:#fff;
  margin-top: 14px;
}
.panel-head{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  align-items: baseline;
  flex-wrap: wrap;
}
.panel-title{
  font-size: 12px;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: var(--muted2);
}
.panel-sub{
  font-size: 12px;
  color: var(--muted2);
}

.chart-wrap{
  margin-top: 10px;
}
canvas{ width:100% !important; height: 220px !important; }

.table-wrap{
  overflow:auto;
  border: 1px solid var(--line);
  border-radius: 16px;
  margin-top: 14px;
}
table{
  width: 100%;
  border-collapse: collapse;
  min-width: 1180px;
  background:#fff;
}
th, td{
  padding: 12px 12px;
  border-bottom: 1px solid var(--line);
  text-align: left;
  vertical-align: top;
  font-size: 14px;
}
th{
  font-size: 12px;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: var(--muted2);
  background: #fff;
  white-space: nowrap;
}
td small{ color: var(--muted2); }

.pos{ color: #0a7a3a; font-weight: 850; }
.neg{ color: #b42318; font-weight: 850; }

.details{ margin-top: 14px; display:grid; gap: 10px; }
details{
  border: 1px solid var(--line);
  border-radius: 16px;
  background:#fff;
  padding: 12px 14px;
}
summary{ cursor:pointer; font-weight: 850; }
.tags{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
.tag{
  border:1px solid var(--line);
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  color: var(--muted);
}

.note{
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid var(--line);
  font-size: 13px;
  color: var(--muted);
}

@media (max-width: 900px){
  .container{ width: min(var(--max), calc(100% - 34px)); }
  .header-inner{ flex-direction: column; align-items:flex-start; }
  .p-kpis{ grid-template-columns: 1fr 1fr; }
  canvas{ height: 220px !important; }
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
<header class="site-header">
  <div class="container header-inner">
    <div class="brand">
      <div class="brand-title">TheMarketBriefDaily</div>
      <div class="brand-sub">Market structure · metals · macro</div>
    </div>
    <nav class="nav">
      <a href="./index.html">Home</a>
      <a class="is-active" href="./investments.html">Investments</a>
      <a href="./about.html">About</a>
      <a href="./disclaimer.html">Disclaimer</a>
    </nav>
  </div>
</header>

<main class="container section">
  <div class="kicker">Public model portfolio</div>
  <h1>Investments</h1>
  <p class="lead">
    Prices are loaded from <span class="mono">./data/quotes.json</span> (shared across devices).
    Performance history is loaded from <span class="mono">./data/performance.json</span> and updates via a scheduled GitHub Action.
  </p>

  <section class="portfolio">
    <div class="portfolio-top">
      <div>
        <div class="p-title">Portfolio Overview</div>
        <div class="p-sub">
          As of <span id="asof" class="mono">—</span> ·
          Last trading day: <span id="lastTS" class="mono">—</span> ·
          Quotes file timestamp: <span id="quotesAsOf" class="mono">—</span>
        </div>
        <div class="statusline">
          <strong>Status:</strong> <span id="quoteStatus" class="mono">loading…</span>
          <span id="healthBadge" class="badge" style="display:none;"></span>
          <span id="quoteError" style="display:none; margin-left:10px;" class="mono"></span>
        </div>
      </div>

      <div class="p-actions">
        <button class="p-btn" id="reloadBtn">Reload quotes</button>
        <button class="p-btn" id="reloadPerfBtn">Reload performance</button>
        <button class="p-btn" id="toggleThesisBtn">Expand all theses</button>
      </div>
    </div>

    <div class="p-kpis">
      <div class="kpi">
        <div class="label">Total Capital</div>
        <div class="value mono" id="totalCap">—</div>
        <div class="sub">Model capital.</div>
      </div>
      <div class="kpi">
        <div class="label">Portfolio Value (NAV)</div>
        <div class="value mono" id="nav">—</div>
        <div class="sub">Holdings + constant cash.</div>
      </div>
      <div class="kpi">
        <div class="label">P/L</div>
        <div class="value mono" id="pl">—</div>
        <div class="sub">Mark-to-market vs cost basis.</div>
      </div>
      <div class="kpi">
        <div class="label">Since Inception</div>
        <div class="value mono" id="si">—</div>
        <div class="sub">Return vs initial capital.</div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-head">
        <div class="panel-title">Performance since inception (NAV)</div>
        <div class="panel-sub">
          Inception: <span id="inception" class="mono">—</span> ·
          Last snapshot: <span id="perfLast" class="mono">—</span>
        </div>
      </div>
      <div class="chart-wrap">
        <canvas id="perfChart" aria-label="Portfolio NAV chart" role="img"></canvas>
      </div>
      <div class="note" style="border-top:none; padding-top:10px;">
        History is stored in <span class="mono">data/performance.json</span> and is appended daily by your GitHub Action.
      </div>
    </div>

    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Asset</th>
            <th>Ticker</th>
            <th class="mono">Shares</th>
            <th class="mono">Entry</th>
            <th class="mono">Last</th>
            <th class="mono">Cost</th>
            <th class="mono">Mkt Value</th>
            <th class="mono">P/L ($)</th>
            <th class="mono">P/L (%)</th>
            <th>Stage</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>

    <div class="details" id="thesisBlocks"></div>

    <div class="note">
      <strong>Disclosure:</strong> informational model portfolio only; not investment advice.
    </div>
  </section>
</main>

<script>
/* =============================================================================
   CONFIG (EDIT HERE)
   - Change entry prices in `entry`
   - Add/remove stocks in `targetDollars`, `entry`, and `meta`
   ========================================================================== */
const TOTAL_CAPITAL = 100000;

// allocations (USD); rest stays constant cash
const targetDollars = {
  AGI:2000,
  FSM:1500,
  GAU:1000,
  NFGC:800,
  VGZ:700,
  NEWP:1000,
  GOOGL:1000
};

// entry prices
const entry = {
  AGI:42.19,
  FSM:10.39,
  GAU:2.73,
  NFGC:2.69,
  VGZ:2.63,
  NEWP:3.53,
  GOOGL:306.55
};

// meta + thesis
const meta = {
  AGI:{ name:"Alamos Gold", stage:"Producer", thesis:["Established producer; lower relative risk.","Watch AISC and guidance execution.","Sized small; cycle+execution."], watch:["AISC","guidance","capex","jurisdiction"] },
  FSM:{ name:"Fortuna Mining", stage:"Producer", thesis:["Gold/silver hybrid with diversification.","Satellite position; margin expansion thesis.","Sized small due to miner beta."], watch:["costs","jurisdiction","balance sheet","metal sensitivity"] },
  GAU:{ name:"Galiano Gold", stage:"Turnaround / Small Cap", thesis:["Turnaround/execution story.","Single-asset concentration acknowledged.","Sized small for idiosyncratic risk."], watch:["resource","operations","financing","country risk"] },
  NFGC:{ name:"New Found Gold", stage:"Developer", thesis:["High-grade optionality; pre-revenue.","Financing/dilution + timeline risk.","Very small sizing."], watch:["drilling","permits","financing","timeline"] },
  VGZ:{ name:"Vista Gold", stage:"Developer", thesis:["Long-dated gold leverage.","Milestone-driven rerating.","Small sizing due to timeline."], watch:["milestones","partnering","capex","jurisdiction"] },
  NEWP:{ name:"New Pacific Metals", stage:"Developer (Silver)", thesis:["Silver optionality.","High jurisdiction/political risk.","Cycle+advancement thesis."], watch:["policy","community","resource","silver cycle"] },

  // NEW: Alphabet / Google
  GOOGL:{
    name:"Alphabet (Google)",
    stage:"Platform / AI Infrastructure",
    thesis:[
      "AI is driving dispersion within software: commoditised workflow tools face substitution risk, while infrastructure and deeply integrated platforms compound.",
      "Google controls high-intent distribution (Search, Android, YouTube) and large-scale data, enabling AI features at the point of intent and monetisation tied to outcomes rather than seats.",
      "AI adoption increases demand for compute, security, and monitoring; Google Cloud is positioned to capture incremental AI workloads as enterprise complexity rises.",
      "Portfolio role: liquid, high-quality AI platform exposure with multiple monetisation engines (ads, cloud, subscriptions) and durable moats."
    ],
    watch:["Search monetization + AI UI","Cloud margin + AI attach rate","Capex intensity","Regulatory/antitrust","Model performance vs peers"]
  }
};
/* ============================================================================= */

const tickers = Object.keys(targetDollars);
const shares = Object.fromEntries(tickers.map(t => [t, targetDollars[t] / entry[t]]));

// Constant cash (do NOT recalc as TOTAL - invested each time)
const INITIAL_INVESTED = Object.values(targetDollars).reduce((a,b)=>a+b,0);
const INITIAL_CASH = Math.max(0, TOTAL_CAPITAL - INITIAL_INVESTED);

// DOM + format
const el = id => document.getElementById(id);
const fmtUSD0 = n => n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:0});
const fmtUSD2 = n => n.toLocaleString(undefined,{style:"currency",currency:"USD",maximumFractionDigits:2});
const fmtPct = n => (n>=0?"+":"") + n.toFixed(2) + "%";

function setError(msg){
  const e = el("quoteError");
  if(!msg){ e.style.display="none"; e.textContent=""; return; }
  e.style.display="inline";
  e.style.color="#b42318";
  e.textContent = "· " + msg;
}
function setBadge(kind, text){
  const b = el("healthBadge");
  b.style.display = "inline-flex";
  b.className = "badge " + (kind === "ok" ? "ok" : "warn");
  b.textContent = text;
}
function normalizePrices(prices){
  const out = {};
  if(!prices || typeof prices !== "object") return out;
  for(const [k,v] of Object.entries(prices)){
    const sym = String(k).trim().toUpperCase();
    const num = (typeof v === "number") ? v : Number(String(v).replace(/[^0-9.\-]/g,""));
    if(sym && Number.isFinite(num) && num > 0) out[sym] = num;
  }
  return out;
}

async function loadSharedQuotes(){
  const res = await fetch("./data/quotes.json?cb=" + Date.now(), { cache: "no-store" });
  if(!res.ok) throw new Error("Failed to load ./data/quotes.json");
  return await res.json();
}
async function loadPerformance(){
  const res = await fetch("./data/performance.json?cb=" + Date.now(), { cache: "no-store" });
  if(!res.ok) throw new Error("Failed to load ./data/performance.json");
  return await res.json();
}

/* ===== Table ===== */
function renderTableSkeleton(){
  const tbody = el("rows");
  tbody.innerHTML = "";
  for(const t of tickers){
    const sh = shares[t];
    const cost = sh * entry[t];
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><strong>${meta[t]?.name || t}</strong><br/><small>${meta[t]?.stage || ""}</small></td>
      <td class="mono"><strong>${t}</strong></td>
      <td class="mono">${sh.toFixed(4)}</td>
      <td class="mono">${fmtUSD2(entry[t])}</td>
      <td class="mono" id="last_${t}">—</td>
      <td class="mono">${fmtUSD0(cost)}</td>
      <td class="mono" id="mv_${t}">—</td>
      <td class="mono" id="pl_${t}">—</td>
      <td class="mono" id="plp_${t}">—</td>
      <td>${meta[t]?.stage || ""}</td>
    `;
    tbody.appendChild(tr);
  }
}

function updateRow(t, price){
  const sh = shares[t];
  const mv = sh * price;
  const cost = sh * entry[t];
  const pl = mv - cost;
  const plPct = (pl / cost) * 100;
  const cls = pl >= 0 ? "pos" : "neg";

  el(`last_${t}`).textContent = fmtUSD2(price);
  el(`mv_${t}`).textContent = fmtUSD0(mv);

  const plEl = el(`pl_${t}`);
  plEl.textContent = fmtUSD0(pl);
  plEl.className = `mono ${cls}`;

  const plpEl = el(`plp_${t}`);
  plpEl.textContent = fmtPct(plPct);
  plpEl.className = `mono ${cls}`;
}

function updateKPIs(prices){
  let holdingsMV = 0;
  let plTotal = 0;
  let pricedCount = 0;

  for(const t of tickers){
    const px = prices[t];
    if(!px) continue;
    pricedCount++;
    const sh = shares[t];
    const mv = sh * px;
    const cost = sh * entry[t];
    holdingsMV += mv;
    plTotal += (mv - cost);
  }

  const nav = holdingsMV + INITIAL_CASH;
  const si = ((nav / TOTAL_CAPITAL) - 1) * 100;

  el("totalCap").textContent = fmtUSD0(TOTAL_CAPITAL);

  if(pricedCount === 0){
    el("nav").textContent = "—";
    el("pl").textContent = "—";
    el("si").textContent = "—";
    return;
  }

  el("nav").textContent = fmtUSD0(nav);
  el("pl").textContent = (plTotal>=0?"+":"") + fmtUSD0(plTotal);
  el("si").textContent = fmtPct(si);
}

/* ===== Theses ===== */
function renderTheses(){
  const wrap = el("thesisBlocks");
  wrap.innerHTML = "";
  for(const t of tickers){
    const d = document.createElement("details");
    const m = meta[t] || { name:t, stage:"", thesis:[], watch:[] };
    d.innerHTML = `
      <summary>${m.name} <span class="mono" style="color:rgba(11,18,32,.46); font-weight:650;">(${t})</span></summary>
      <div class="note" style="border-top:none; padding-top:8px;">
        <div class="kicker" style="margin:0 0 6px;">Thesis</div>
        <ul style="margin:0 0 10px 18px; color:rgba(11,18,32,.68);">
          ${(m.thesis||[]).map(x=>`<li>${x}</li>`).join("")}
        </ul>
        <div class="kicker" style="margin:0 0 6px;">What to watch</div>
        <div class="tags">
          ${(m.watch||[]).map(w=>`<span class="tag">${w}</span>`).join("")}
        </div>
      </div>
    `;
    wrap.appendChild(d);
  }
}

/* ===== Apply Quotes ===== */
function applyQuotes(q){
  const prices = normalizePrices(q.prices);
  for(const t of tickers){
    if(prices[t]) updateRow(t, prices[t]);
  }
  updateKPIs(prices);

  const have = Object.keys(prices).length;
  if(have === 0){
    el("quoteStatus").textContent = "quotes loaded, but prices missing";
    setBadge("warn", "no prices");
    setError("Your data/quotes.json has empty or invalid prices. Fix the GitHub Action.");
  } else if(have < tickers.length){
    el("quoteStatus").textContent = `partial quotes (${have}/${tickers.length})`;
    setBadge("warn", `${tickers.length - have} missing`);
    setError("Some symbols missing in quotes.json (likely symbol mapping).");
  } else {
    el("quoteStatus").textContent = "ok (shared quotes)";
    setBadge("ok", "priced");
    setError("");
  }
}

/* ===== Performance Chart ===== */
let perfChart = null;

function renderPerfChart(perf){
  const hist = Array.isArray(perf?.nav_history) ? perf.nav_history : [];
  el("inception").textContent = perf?.inception || "—";
  el("perfLast").textContent = hist.length ? hist[hist.length - 1].date : "—";

  const labels = hist.map(x => x.date);
  const navs = hist.map(x => Number(x.nav));

  const ctx = document.getElementById("perfChart");

  if(perfChart){
    perfChart.destroy();
    perfChart = null;
  }

  // Empty state
  if(!hist.length){
    perfChart = new Chart(ctx, {
      type: "line",
      data: { labels: ["No history"], datasets: [{ data: [0], borderWidth: 2, tension: 0.25, pointRadius: 0 }] },
      options: {
        plugins:{ legend:{ display:false }, tooltip:{ enabled:false } },
        scales:{ x:{ display:false }, y:{ display:false } }
      }
    });
    return;
  }

  perfChart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: "NAV (USD)",
        data: navs,
        borderWidth: 2,
        tension: 0.25,
        pointRadius: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins:{
        legend:{ display:false },
        tooltip:{
          callbacks:{
            label: (item) => "NAV: " + fmtUSD0(item.parsed.y)
          }
        }
      },
      scales:{
        x:{
          ticks:{ maxTicksLimit: 8, color: "rgba(11,18,32,.46)" },
          grid:{ color: "rgba(11,18,32,.08)" }
        },
        y:{
          ticks:{
            color: "rgba(11,18,32,.46)",
            callback: (v) => "$" + Number(v).toLocaleString()
          },
          grid:{ color: "rgba(11,18,32,.08)" }
        }
      }
    }
  });
}

/* ===== Boot ===== */
async function bootQuotes(){
  el("quoteStatus").textContent = "loading quotes…";
  setBadge("warn", "loading");
  setError("");

  try{
    const q = await loadSharedQuotes();
    el("quotesAsOf").textContent = q.asof_iso || "—";
    el("lastTS").textContent = q.last_trading_day || "—";
    applyQuotes(q);
  }catch(e){
    el("quoteStatus").textContent = "failed to load quotes.json";
    setBadge("warn", "no quotes.json");
    setError(String(e.message || e));
  }
}

async function bootPerformance(){
  try{
    const p = await loadPerformance();
    renderPerfChart(p);
  }catch(e){
    el("inception").textContent = "—";
    el("perfLast").textContent = "—";
    renderPerfChart({ inception:"—", nav_history: [] });
  }
}

async function boot(){
  el("asof").textContent = new Date().toLocaleDateString(undefined,{year:"numeric",month:"short",day:"2-digit"});
  el("totalCap").textContent = fmtUSD0(TOTAL_CAPITAL);

  renderTableSkeleton();
  renderTheses();

  await Promise.all([bootQuotes(), bootPerformance()]);
}

/* ===== UI ===== */
el("reloadBtn").addEventListener("click", bootQuotes);
el("reloadPerfBtn").addEventListener("click", bootPerformance);

let expanded = false;
el("toggleThesisBtn").addEventListener("click", ()=>{
  const blocks = document.querySelectorAll("#thesisBlocks details");
  expanded = !expanded;
  blocks.forEach(d => d.open = expanded);
  el("toggleThesisBtn").textContent = expanded ? "Collapse all theses" : "Expand all theses";
});

boot();
</script>
</body>
</html>
